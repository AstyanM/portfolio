---
import BaseLayout from '@/layouts/BaseLayout.astro';
import ProjectGrid from '@/components/react/ProjectGrid';
import TechStack from '@/components/astro/TechStack.astro';
import Timeline from '@/components/astro/Timeline.astro';
import { getCollection } from 'astro:content';
import ProjectSpotlight from '@/components/astro/ProjectSpotlight.astro';
import HeroBackground from '@/components/astro/HeroBackground.astro';
import Typewriter from '@/components/react/Typewriter';
import { ArrowRight } from 'lucide-react';

const allProjects = await getCollection('projects', ({ data }) => {
  return data.lang === 'en' && !data.draft;
});

// Remove the spotlight project from the grid to avoid duplication
const spotlightSlug = 'simulateur-parcoursup';
const filteredProjectsList = allProjects.filter(p => !p.slug.includes(spotlightSlug));

// Sort by date (most recent first)
const projects = filteredProjectsList.sort((a, b) => {
  if (!a.data.date || !b.data.date) return 0;
  return new Date(b.data.date).getTime() - new Date(a.data.date).getTime();
});

// Transform for ProjectGrid
const projectsData = projects.slice(0, 6).map((p) => ({
  slug: p.slug,
  title: p.data.title,
  description: p.data.description,
  tags: p.data.tags,
  href: `/en/projects/${p.slug.split('/')[1]}`,
  coverUrl: p.data.cover?.src,
}));
---

<BaseLayout title="Astyan Martin | Portfolio">
  <!-- Hero Section -->
  <section class="relative py-20 md:py-32 overflow-hidden">
    <!-- Animated Background -->
    <HeroBackground />

    <!-- Background gradient overlay for text readability -->
    <div
      class="absolute inset-0 bg-gradient-to-b from-transparent via-background/50 to-background pointer-events-none"
    >
    </div>

    <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 relative">
      <div class="max-w-3xl">
        <p class="text-accent font-medium mb-4 animate-fade-in">Welcome!</p>

        <h1
          class="text-4xl md:text-5xl lg:text-6xl font-bold text-foreground mb-6 animate-slide-up"
        >
          I'm <span class="gradient-text">Astyan Martin</span>
        </h1>

        <div class="min-h-[100px] mb-8">
          <Typewriter
            client:visible
            text="Engineering student, curious and passionate about many technical fields. This portfolio showcases my most significant projects, blending AI exploration, algorithms and hardware design."
            speed={25}
            delay={500}
            className="text-lg md:text-xl text-foreground-secondary leading-relaxed"
          />
        </div>

        <div
          class="flex flex-wrap gap-4 animate-slide-up"
          style="animation-delay: 2.5s"
        >
          <a
            href="/en/projects"
            class="inline-flex items-center gap-2 px-6 py-3 bg-accent text-white rounded-lg hover:bg-accent-hover transition-colors font-medium"
          >
            Discover my projects
            <ArrowRight className="w-4 h-4" />
          </a>
        </div>
      </div>
    </div>
  </section>

  <TechStack lang="en" />
  <Timeline lang="en" />

  <!-- Featured Projects Section -->
  <section class="py-16 md:py-24">
    <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">

      <div class="mb-16">
        <ProjectSpotlight lang="en" />
      </div>

      <div class="flex items-end justify-between mb-12">
        <div>
          <h2 class="text-3xl font-bold text-foreground mb-2">Other Projects</h2>
          <p class="text-foreground-secondary">
            A selection of technical projects combining exploration and innovation.
          </p>
        </div>
        <a
          href="/en/projects"
          class="hidden sm:inline-flex items-center gap-1 text-accent hover:text-accent-hover transition-colors font-medium"
        >
          View all projects
          <ArrowRight className="w-4 h-4" />
        </a>
      </div>

      <ProjectGrid client:visible projects={projectsData} lang="en" showFilter={false} />

      <div class="mt-8 text-center sm:hidden">
        <a
          href="/en/projects"
          class="inline-flex items-center gap-1 text-accent hover:text-accent-hover transition-colors font-medium"
        >
          View all projects
          <ArrowRight className="w-4 h-4" />
        </a>
      </div>
    </div>
  </section>
</BaseLayout>
