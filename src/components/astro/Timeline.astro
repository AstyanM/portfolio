---
import { Briefcase, GraduationCap, MapPin, Calendar } from 'lucide-react';
import { useTranslations } from '@/i18n/utils';
import type { Lang } from '@/i18n/ui';

const { lang = 'en' } = Astro.props;
const t = useTranslations(lang as Lang);

const translations = {
  fr: {
    education: [
      {
        name: "Università di Trento",
        location: "Italie",
        period: "Fév - Juin 2025",
        detail: "Erasmus",
        icon: "trento",
        description: [
          "Cours spécialisés en data science et intelligence artificielle"
        ]
      },
      {
        name: "École Centrale de Lille",
        location: "Lille",
        period: "2023 - 2027",
        detail: "Ingénieur généraliste",
        icon: "centrale",
        description: [
          "Formation généraliste avec projets en data science et gestion de projet",
          "Projet NLP/LLM avec le SIB pour l'aide à la décision clinique"
        ]
      },
      {
        name: "Lycée Kléber",
        location: "Strasbourg",
        period: "2021 - 2023",
        detail: "PCSI → PC*",
        icon: "kleber",
        description: [
          "Spécialisation en Physique et Mathématiques",
          "Préparation théorique et pratique aux concours"
        ]
      }
    ],
    internships: [
      {
        date: "Mars - Juil 2026",
        title: "Stagiaire IA",
        company: "MBDA",
        companyUrl: "https://www.mbda-systems.com/country-fr?rc=1",
        location: "France",
        upcoming: true,
        description: []
      },
      {
        date: "Sept 2025 - Fév 2026",
        title: "Stagiaire IA & Automatisation",
        company: "Prevision",
        companyUrl: "https://prepa-prevision.fr/",
        location: "Paris",
        upcoming: false,
        description: [
          "Développement fullstack d'outils d'aide à l'orientation",
          "Fine-tuning d'IA à des fins éducatives",
          "Automatisation de processus avec n8n"
        ]
      },
      {
        date: "Jan - Fév 2024",
        title: "Stagiaire Technicien R&D",
        company: "Ricoh Industrie France",
        companyUrl: "https://www.ricoh-thermal.com/fr/",
        location: "Wettolsheim",
        upcoming: false,
        description: [
          "Tests et analyses des performances produits",
          "Caractérisation des matériaux",
          "Gestion et interprétation des données expérimentales"
        ]
      }
    ]
  },
  en: {
    education: [
      {
        name: "Università di Trento",
        location: "Italy",
        period: "Feb - June 2025",
        detail: "Erasmus",
        icon: "trento",
        description: [
          "Specialized courses in data science and artificial intelligence"
        ]
      },
      {
        name: "École Centrale de Lille",
        location: "Lille",
        period: "2023 - 2027",
        detail: "General Engineering",
        icon: "centrale",
        description: [
          "Generalist training with projects in data science and project management",
          "NLP/LLM project with SIB for clinical decision support"
        ]
      },
      {
        name: "Lycée Kléber",
        location: "Strasbourg",
        period: "2021 - 2023",
        detail: "PCSI → PC*",
        icon: "kleber",
        description: [
          "Specialization in Physics and Mathematics",
          "Theoretical and practical preparation for competitive exams"
        ]
      }
    ],
    internships: [
      {
        date: "Mar - Jul 2026",
        title: "AI Intern",
        company: "MBDA",
        companyUrl: "https://www.mbda-systems.com/country-fr?rc=1",
        location: "France",
        upcoming: true,
        description: []
      },
      {
        date: "Sept 2025 - Feb 2026",
        title: "AI & Automation Intern",
        company: "Prevision",
        companyUrl: "https://prepa-prevision.fr/",
        location: "Paris",
        upcoming: false,
        description: [
          "Fullstack development of orientation tools for students",
          "AI fine-tuning for educational purposes",
          "Process automation with n8n"
        ]
      },
      {
        date: "Jan - Feb 2024",
        title: "R&D Technician Intern",
        company: "Ricoh Industrie France",
        companyUrl: "https://www.ricoh-thermal.com/fr/",
        location: "Wettolsheim",
        upcoming: false,
        description: [
          "Product performance testing and analysis",
          "Material characterization",
          "Management and interpretation of experimental data"
        ]
      }
    ]
  }
};

const data = translations[lang] || translations.fr;
const base = import.meta.env.BASE_URL.replace(/\/$/, '');
---

<section class="py-20 md:py-28">
  <div class="max-w-5xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="mb-12 animate-on-scroll">
      <h2 class="text-3xl font-bold font-display text-foreground mb-4">{t('timeline.title')}</h2>
      <p class="text-foreground-secondary">
        {t('timeline.subtitle')}
      </p>
    </div>

    <div class="relative grid grid-cols-1 lg:grid-cols-2 gap-8 lg:gap-16">
      <!-- Vertical divider -->
      <div class="hidden lg:block absolute left-1/2 top-0 bottom-0 w-px bg-gradient-to-b from-transparent via-border to-transparent"></div>

      <!-- Formation -->
      <div class="lg:pr-8 stagger-children">
        <h3 class="text-xl font-semibold text-foreground mb-6 flex items-center gap-2 stagger-item-left">
          <GraduationCap className="w-5 h-5 text-foreground" />
          {t('timeline.educationTitle')}
        </h3>

        <div class="relative space-y-6">
          <div class="timeline-line absolute top-0 left-0 ml-6 -translate-x-px w-0.5 bg-gradient-to-b from-foreground via-border to-transparent"></div>
          {data.education.map((item) => (
            <div class="relative flex items-start stagger-item-left">
              <!-- Icon -->
              <div class="w-12 h-12 rounded-lg bg-background border-2 border-foreground/30 flex items-center justify-center shrink-0 overflow-hidden z-10">
                <img
                  src={`${base}/assets/schools/${item.icon}_light.png`}
                  alt={item.name}
                  class="w-10 h-10 object-contain school-logo"
                  data-logo-name={item.icon}
                  data-base-path={base}
                  onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';"
                />
                <GraduationCap className="w-6 h-6 text-foreground hidden" />
              </div>

              <!-- Connector -->
              <div class="w-4 h-0.5 mt-5 bg-gradient-to-r from-foreground/30 to-foreground/10 shrink-0"></div>

              <!-- Content -->
              <div class="flex-1 p-4 rounded-xl border border-border bg-background-secondary">
                <div class="flex items-start justify-between gap-2 mb-1">
                  <h4 class="font-semibold text-foreground">{item.name}</h4>
                  <time class="text-xs text-foreground-secondary whitespace-nowrap">{item.period}</time>
                </div>
                <p class="text-sm text-foreground mb-1">{item.detail}</p>
                <p class="text-xs text-foreground-secondary flex items-center gap-1 mb-2">
                  <MapPin className="w-3 h-3" />
                  {item.location}
                </p>
                <ul class="space-y-1">
                  {item.description.map((desc) => (
                    <li class="text-sm text-foreground-secondary leading-relaxed flex items-start gap-2">
                      <span class="mt-1.5 w-1 h-1 rounded-full bg-foreground-secondary/50 shrink-0"></span>
                      {desc}
                    </li>
                  ))}
                </ul>
              </div>
            </div>
          ))}
        </div>
      </div>

      <!-- Stages avec Timeline -->
      <div class="lg:pl-8 stagger-children">
        <h3 class="text-xl font-semibold text-foreground mb-6 flex items-center gap-2 stagger-item-right">
          <Briefcase className="w-5 h-5 text-accent" />
          {t('timeline.internshipsTitle')}
        </h3>

        <div class="relative space-y-6">
          <div class="timeline-line absolute top-0 left-0 ml-5 -translate-x-px w-0.5 bg-gradient-to-b from-accent via-border to-transparent"></div>
          {data.internships.map((item) => (
            <div class="relative flex items-start stagger-item-right">
              <!-- Timeline dot -->
              <div class={`flex items-center justify-center w-10 h-10 rounded-full border-2 bg-background shrink-0 z-10 ${item.upcoming ? 'border-accent animate-pulse-glow' : 'border-border'}`}>
                <Briefcase className={`w-4 h-4 ${item.upcoming ? 'text-accent' : 'text-foreground-secondary'}`} />
              </div>

              <!-- Connector -->
              <div class={`w-4 h-0.5 mt-4 shrink-0 ${item.upcoming ? 'bg-gradient-to-r from-accent/50 to-accent/20' : 'bg-gradient-to-r from-border/80 to-border/30'}`}></div>

              <!-- Content -->
              <div class={`flex-1 p-4 rounded-xl border transition-colors ${item.upcoming ? 'border-accent/50 bg-accent/5 shadow-lg shadow-accent/10' : 'border-border bg-background-secondary'}`}>
                <div class="flex items-center gap-2 mb-2">
                  {item.upcoming && (
                    <span class="text-[10px] font-semibold px-2 py-0.5 rounded-full bg-accent text-white uppercase">
                      {t('timeline.upcoming')}
                    </span>
                  )}
                  <time class="text-xs text-foreground-secondary flex items-center gap-1">
                    <Calendar className="w-3 h-3" />
                    {item.date}
                  </time>
                </div>

                <h4 class="font-semibold text-foreground">{item.title}</h4>
                {item.companyUrl ? (
                  <a
                    href={item.companyUrl}
                    target="_blank"
                    rel="noopener noreferrer"
                    class="text-sm text-accent hover:text-accent-hover hover:underline transition-colors"
                  >
                    {item.company}
                  </a>
                ) : (
                  <p class="text-sm text-accent">{item.company}</p>
                )}
                <p class="text-xs text-foreground-secondary flex items-center gap-1 mt-1 mb-2">
                  <MapPin className="w-3 h-3" />
                  {item.location}
                </p>

                <ul class="space-y-1">
                  {item.description.map((desc) => (
                    <li class="text-sm text-foreground-secondary leading-relaxed flex items-start gap-2">
                      <span class="mt-1.5 w-1 h-1 rounded-full bg-foreground-secondary/50 shrink-0"></span>
                      {desc}
                    </li>
                  ))}
                </ul>
              </div>
            </div>
          ))}
        </div>
      </div>
    </div>
  </div>
</section>


<script>
  // Update logo sources when theme changes dynamically
  function updateLogos() {
    const isDark = document.documentElement.classList.contains('dark');
    const logos = document.querySelectorAll('.school-logo');

    logos.forEach((logo) => {
      const img = logo as HTMLImageElement;
      const logoName = img.dataset.logoName;
      const basePath = img.dataset.basePath || '';

      if (logoName) {
        const theme = isDark ? 'dark' : 'light';
        img.src = `${basePath}/assets/schools/${logoName}_${theme}.png`;
      }
    });
  }

  // Run on every page load (including ViewTransitions navigations)
  document.addEventListener('astro:page-load', () => {
    updateLogos();
  });

  // Listen for real-time theme changes
  const observer = new MutationObserver((mutations) => {
    mutations.forEach((mutation) => {
      if (mutation.attributeName === 'class') {
        updateLogos();
      }
    });
  });

  observer.observe(document.documentElement, {
    attributes: true,
    attributeFilter: ['class']
  });
</script>
